# 一、环境准备

### 1.安装miniconda3

如果服务器没有安装miniconda3，运行如下命令安装：

```
bash Miniconda3-latest-Linux-x86_64.sh
```

根据选择`miniconda3`的安装目录，如将miniconda3安装到用户目录下`~/miniconda3`。

### 2.创建和激活运行环境

使用conda来创建环境，运行环境可以选择使用python 3.7.16，其他的依赖包按照requirements.txt安装：

```bash
conda create -n klbr python=3.7.16
conda activate klbr
pip install -r requirements.txt
```

### 3.docker部署
（改）
```bash
方法一：
cd kv
docker load -i kv.tar
docker images
docker run -itd -p 5000:5000 kv:v1.0
方法二：
cd kv
docker build -t kv:v1.0 .
docker run -itd -p 5000:5000 kv:v1.0
```

# 二、数据和测试

### 1.post地址
#### 1.1 省略词填充
127.0.0.1:5000/se
#### 1.2 错别字纠正
127.0.0.1:5000/pc
#### 1.3 时间填充
127.0.0.1:5000/tf
#### 1.4 错别字纠正
127.0.0.1:5000/pun
#### 1.5 术语标准化
127.0.0.1:5000/ts


### 2.数据格式
#### 2.1 省略词填充
输入：输入一段文本信息，例如：“膀胱充盈尚可，膀胱壁略增厚，强化较均匀，其内可见导尿管影。”
输出：输出填充后的文本信息，例如：“乙状结肠管壁不规则增厚，乙状结肠管壁较厚处约2.5cm，乙状结肠管壁增强扫描明显强化，乙状结肠管壁浆膜面毛糙，乙状结肠管壁邻近脂肪间隙略模糊，可见多个短径小于1.0cm淋巴结影。”
#### 2.2 错别字纠正
输入：输入一段文本信息，例如：“消炎请吃头孢克洛颗粒。”
输出：输出纠正后的文本信息，例如：“消炎请吃头孢克洛克力。”
#### 2.3 时间填充
输入：输入一段文本信息，例如：“现病史:患者自诉因大便性状改变于4月至我院住院治疗，06盆腔MRI提示：乙状结肠和直肠交界区巨大肿块，考虑为结肠癌，周围淋巴结显示（多发）。胸腹部CT提示：1.盆腔肿块，建议行盆腔CT扫描；2.胸部CT平扫+增强未见明显异常。（2018-4-13）行肠镜检查后完善病理：1.（乙状结肠）腺癌，请密切结合临床进一步明确浸润情况；2.（直肠）腺癌，请密切结合临床进一步明确浸润情况。免疫组化：MLH1×2(+)；MSH2×2(+)；MSH6×2(+)；PMS2×2(+)。因肿瘤体积大，手术难度高，经肿瘤放疗科会诊后，分别于05-03、05-31及06-21行三周期奥沙利铂联合卡培他滨化疗，并于05-09至06-11同步行盆腔放疗，过程顺利，患者无明显不适症状。”
输出：输出填充后的文本信息，例如：“现病史:患者自诉因大便性状改变于2018年4月至我院住院治疗，06盆腔MRI提示：乙状结肠和直肠交界区巨大肿块，考虑为结肠癌，周围淋巴结显示（多发）。胸腹部CT提示：1.盆腔肿块，建议行盆腔CT扫描；2.胸部CT平扫+增强未见明显异常。（2018-4-13）行肠镜检查后完善病理：1.（乙状结肠）腺癌，请密切结合临床进一步明确浸润情况；2.（直肠）腺癌，请密切结合临床进一步明确浸润情况。免疫组化：MLH1×2(+)；MSH2×2(+)；MSH6×2(+)；PMS2×2(+)。因肿瘤体积大，手术难度高，经肿瘤放疗科会诊后，分别于2018-05-03、2018-05-31及2018-06-21行三周期奥沙利铂联合卡培他滨化疗，并于2018-05-09至2018-06-11同步行盆腔放疗，过程顺利，患者无明显不适症状。”
#### 2.4 标点符号纠正
输入：输入一段文本信息，例如：“临床提示“结肠癌术后”改变，未见复发，2、肝脏多发类圆形低密度影，与2018-5-7CT对比，所见大致同前，考虑囊肿可能3、脂肪肝，4、副脾，同前。”
输出：输出纠正后的文本信息，例如：“、临床提示“结肠癌术后”改变，未见复发。2、肝脏多发类圆形低密度影，与2018-5-7CT对比，所见大致同前，考虑囊肿可能。3、脂肪肝。4、副脾，同前。”
#### 2.5 术语标准化
输入：输入一个非标准词，例如：“维格尔牌西洋参精软胶囊”
输出：输出对应的标准词，例如：“西洋参精软胶囊”


# 三、代码说明

文件目录格式如下：

```
![image](https://github.com/1723408170/1/assets/114632599/3898ba5d-bb4e-4371-ada9-f797dad22757)

```

model_best是训练好的模型文件，Dockerfile是用于docker部署的文件，requirements.txt是所需的依赖包文件，UIEkv.py是项目主文件，用于处理输入数据，加载模型，分析文本和处理输出结果等。

UIEkv.py中的kvExtract()函数：

```python
def kvExtract():
	""""
	函数功能：用于接收用户输入数据，用模型对输入数据进行分析，然后返回输出结果
	Args:用户输入数据放在请求的form中的text字段，输入为json格式；返回结果是json格式。
	""""
```

